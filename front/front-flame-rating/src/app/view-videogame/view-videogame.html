<div *ngIf="videoGame" class="game-detail-page">

  <section class="game-info-section">
    <h1 class="game-title">{{ videoGame.title }}</h1>

    <div class="main-content-flex">

      <!-- 
        ¡NUEVA ESTRUCTURA! 
        Esta columna envuelve la Galería (arriba) y las Reseñas (abajo) 
      -->
      <div class="left-column">

        <!-- La galería (tu código original, no se toca) -->
        <div class="gallery-container">
            <div class="main-media-display"> 
                <iframe 
                    *ngIf="safeVideoUrl" 
                    [src]="safeVideoUrl"
                    width="100%" 
                    height="auto" 
                    frameborder="0" 
                    allow="autoplay; fullscreen"
                    allowfullscreen>
                </iframe>
                
                <img 
                    *ngIf="mainImageSrc" 
                    [src]="mainImageSrc" 
                    alt="Imagen principal">
            </div>

            <div class="thumbnail-list">
                <div 
                    class="thumbnail video-thumbnail" 
                    (click)="selectTrailer()"
                    [class.active]="selectedMediaUrl === safeVideoUrl"> 
                    
                    <img [src]="imageList[0].largeSrc" alt="Tráiler">
                    <span class="label">TRÁILER</span>
                </div>

                <div 
                    *ngFor="let img of imageList" 
                    class="thumbnail image-thumbnail"
                    (click)="selectImage(img)"
                    [class.active]="selectedMediaUrl === img.thumbnailSrc">
                    
                    <img [src]="img.thumbnailSrc" [alt]="img.alt">
                </div>
            </div>
        </div> <!-- Fin de gallery-container -->

        <!-- 
          ¡SECCIÓN MOVIDA AQUÍ! 
          Las reseñas ahora van en la columna izquierda, debajo de la galería.
        -->
        <section class="game-review-section">
          <h3>Reseñas de Usuarios</h3>
          <div *ngIf="!videoGame.reviews || videoGame.reviews.length === 0" class="no-reviews">
            <p>Este juego aún no tiene reseñas. ¡Sé el primero en dejar una!</p>
          </div>
          <div class="reviews-container" *ngIf="videoGame.reviews.length > 0">
              <div class="review-card" *ngFor="let review of videoGame.reviews">
                <h4>{{review.userName}}</h4>
                <!-- 
                  ¡¡¡CAMBIO AQUÍ!!!
                  Reemplazamos el <strong> por la nueva estructura de llamas
                -->
                <div class="review-rating">
                  <span>Su calificación:</span>
                  <div class="flame-display">
                    <!-- 
                      Usamos la nueva función 'createArrayFromNumber' 
                      para repetir la imagen 'review.rating' veces 
                    -->
                    <img 
                      *ngFor="let i of createArrayFromNumber(review.rating)"
                      src="/flame-rating-images/flame-calification.png"
                      alt="flame icon"
                    >
                  </div>
                </div>
                
                <p class="review-comment">
                  "{{ review.comment }}"
                </p>
              </div>
          </div>
        </section> <!-- Fin de game-review-section -->
      
      </div> <!-- Fin de left-column -->


      <!-- El cuadro de info (Sin tocar, sigue siendo la columna derecha) -->
      <div class="presentationVideogame">
          
          <div class="info-scroll-area">
            <img class="info-box-image" [src]="imageList[0].largeSrc" [alt]="videoGame.title">
            
            <h2>Sinopsis</h2>
            <p>{{ videoGame.synopsis }}</p>
            
            <h3>Detalles del Juego</h3>
            <ul class="game-metadata details-grid">
              <!-- Fila 1 -->
              <li class="grid-item">
                <strong>Fecha de Estreno:</strong> 
                <span>{{videoGame.releaseDate}}</span>
              </li>
              <li class="grid-item">
                <strong>Desarrolladora:</strong> 
                <span>{{ videoGame.developer }}</span>
              </li>
        
              <!-- Fila 2 -->
              <li class="grid-item">
                <strong>Categoría:</strong> 
                <span class="value-orange">{{ videoGame.category }}</span>
              </li>
              <li class="grid-item">
                <strong>Géneros:</strong>
                <span class="value-orange">{{ videoGame.genre.join(', ') }}</span>
              </li>
        
              <!-- Fila 3 (Full Width) -->
              <li class="grid-item full-width">
                <strong>Plataformas:</strong>
                <ul class="platform-tags-list">
                  <li *ngFor="let platform of videoGame.platform">{{platform}}</li>
                </ul>
              </li>
            </ul>
          </div> <!-- Fin de info-scroll-area -->

          <div class="review-action-area">
            
            <!-- ¡NUEVA LÍNEA! Este es el "escenario" para las partículas -->
            <div class="particle-container" #particleContainer></div>

            <div class="average-rating-container">
              <div class="rating">
                <span>{{ videoGame.averageRating }}</span>
              </div>
              <strong>Calificación promedia</strong>
            </div>
            
            <div class="flame-rating-input">
              <img 
                *ngFor="let i of [1, 2, 3, 4, 5]" 
                src="/flame-rating-images/flame-calification.png" 
                alt="flame rating"
                [class.active]="i <= (hoveredRating || selectedRating)"
                (click)="rate(i)"
                (mouseover)="handleMouseOver(i)"
                (mouseleave)="handleMouseLeave()"
              >
            </div>
            
            <div *ngIf="videoGame && !showReviewModal" class="review-button-container">
              <button (click)="openReviewModal()">Dejar Comentario</button>
          </div>

            <app-create-review 
                *ngIf="showReviewModal && videoGame"
                [videoGameId]="videoGame.id"
                (closeDialog)="closeReviewModal()"
                (reviewSaved)="handleReviewSaved()"
            ></app-create-review>
          </div>
      
      </div> <!-- Fin de presentationVideogame -->
    
    </div> <!-- Fin de main-content-flex -->

  </section> 

</div>