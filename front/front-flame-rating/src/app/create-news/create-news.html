<div class="form-container">

  <div *ngIf="!isPreviewing && !showSuccessModal">
    <h2>Redactar Noticia</h2>
    <p>Ingresa los datos de la noticia.</p>

    <form (ngSubmit)="onReview()" #newsForm="ngForm">
      
      <div class="form-group">
        <label for="title">TÃ­tulo</label>
        <input 
          type="text" id="title" name="title" 
          [(ngModel)]="news.title" 
          required 
          placeholder="Ej: Nuevo lanzamiento...">
      </div>

      <div class="form-group">
        <label for="textNews">Texto de la Noticia</label>
        <textarea 
          id="textNews" name="textNews" 
          [(ngModel)]="news.textNews" 
          required rows="8" maxlength="1000" 
          placeholder="Escribe aquÃ­...">
        </textarea>
        <div class="char-count">{{ news.textNews.length || 0 }} / 1000 caracteres</div>
      </div>

      <div class="form-group">
        <label for="urlImages">URLs de ImÃ¡genes (Opcional)</label>
        <input 
          type="text" id="urlImages" name="urlImages" 
          [(ngModel)]="news.urlImages" 
          #urlImages="ngModel" 
          pattern="^https?://\S+(,https?://\S+)*$" 
          placeholder="URL1.jpg,URL2.png...">
        <small *ngIf="urlImages.invalid && (urlImages.dirty || urlImages.touched)" class="error-text">
          Formato invÃ¡lido: Usa comas para separar y NO uses espacios.
        </small>
      </div>

      <div class="form-group">
        <label for="urlVideo">URLs de Videos (Opcional)</label>
        <input 
          type="text" id="urlVideo" name="urlVideo" 
          [(ngModel)]="news.urlVideo" 
          #urlVideo="ngModel" 
          pattern="^https?://\S+(,https?://\S+)*$" 
          placeholder="youtube.com...">
        <small *ngIf="urlVideo.invalid && (urlVideo.dirty || urlVideo.touched)" class="error-text">
          Formato invÃ¡lido: Sin espacios.
        </small>
      </div>

      <div class="button-group">
        <button type="submit" class="btn-submit" [disabled]="!newsForm.form.valid">
          Revisar y Guardar
        </button>
        <button type="button" class="btn-cancel" (click)="goBack()">
          Cancelar
        </button>
      </div>
    </form>
  </div>

  <div *ngIf="isPreviewing && !showSuccessModal">
    <h2>Vista Previa</h2>
    <p>AsÃ­ se verÃ¡ tu noticia. Â¿QuÃ© deseas hacer?</p>

    <div class="preview-card">
      <h3>{{ news.title }}</h3>
      <span class="preview-date">Fecha: Hoy</span>
      
      <div class="preview-media">
        <div *ngFor="let img of getImagesArray()" class="preview-img-container">
          <img [src]="img" alt="Preview">
        </div>
        
        <div *ngFor="let vid of getVideosArray()" class="video-placeholder">
           <p *ngIf="!isYoutube(vid)">ðŸŽ¥ Video adjunto (.mp4)</p>
           <div *ngIf="isYoutube(vid)" class="iframe-container">
             <iframe [src]="getYoutubeEmbedUrl(vid)" frameborder="0" allowfullscreen></iframe>
           </div>
        </div>
      </div>

      <p class="preview-text">{{ news.textNews }}</p>
    </div>

    <div class="button-group action-buttons">
      <button type="button" class="btn-publish" (click)="onPublish()">Publicar</button>
      <button type="button" class="btn-modify" (click)="onModify()">Modificar</button>
      <button type="button" class="btn-delete" (click)="onDiscard()">Eliminar</button>
    </div>
  </div>

  <div *ngIf="showSuccessModal" class="success-modal">
    <div class="success-icon">âœ…</div>
    <h2>Â¡Noticia publicada con Ã©xito!</h2>
    <p>Â¿Deseas publicar otra noticia?</p>
    
    <div class="button-group center-buttons">
      <button type="button" class="btn-submit" (click)="createAnother()">SÃ­, crear otra</button>
      <button type="button" class="btn-cancel" (click)="finish()">No, salir</button>
    </div>
  </div>

  <div *ngIf="errorMessage" class="message error">
    {{ errorMessage }}
  </div>

</div>