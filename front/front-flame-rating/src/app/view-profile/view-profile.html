<div class="profile-container">
    <div *ngIf="isLoading" class="loading-message">
        Cargando datos del perfil...
    </div>

    <!-- Se muestra solo si el usuario existe (est치 logueado) -->
    <div *ngIf="!isLoading && currentUser" class="profile-card">
        
        <!-- T칤tulo din치mico -->
        <h2 class="title">{{ isEditing ? 'Modificar Perfil' : 'Visualizar Perfil' }}</h2>
        <hr class="separator">

        <!-- Mensajes de 칠xito o error -->
        <div *ngIf="message" [ngClass]="{'message-success': messageType === 'success', 'message-error': messageType === 'error'}" class="status-message">
            {{ message }}
        </div>

        <!-- Contenido principal: Grid de 2 columnas -->
        <div class="profile-content">
            
            <!-- Columna Izquierda: Campos de informaci칩n -->
            <div class="profile-info">
                
                <!-- Campo de Email -->
                <div class="input-group">
                    <label for="email-field">Email</label>
                    <input 
                        id="email-field" 
                        type="email" 
                        [(ngModel)]="editData.email"
                        [readonly]="!isEditing" 
                        class="profile-input"
                        [ngClass]="{'editable-input': isEditing}"
                    >
                </div>

                <!-- Campo de Nombre de Usuario -->
                <div class="input-group">
                    <label for="username-field">Nombre de usuario</label>
                    <input 
                        id="username-field" 
                        type="text" 
                        [(ngModel)]="editData.username"
                        [readonly]="!isEditing" 
                        class="profile-input"
                        [ngClass]="{'editable-input': isEditing}"
                    >
                </div>

                <!-- SECCI칍N DE CAMBIO DE CONTRASE칌A (Solo visible en modo edici칩n) -->
                <ng-container *ngIf="isEditing">

                    <!-- Nueva Contrase침a -->
                    <div class="input-group">
                        <label for="new-password">Nueva contrase침a</label>
                        <input 
                            id="new-password" 
                            type="password" 
                            [(ngModel)]="newPassword"
                            placeholder="Ingrese nueva contrase침a"
                            class="profile-input editable-input"
                        >
                    </div>

                    <!-- Confirmar Nueva Contrase침a -->
                    <div class="input-group">
                        <label for="confirm-password">Confirmar nueva contrase침a</label>
                        <input 
                            id="confirm-password" 
                            type="password" 
                            [(ngModel)]="confirmPassword"
                            placeholder="Repita la nueva contrase침a"
                            class="profile-input editable-input"
                        >
                    </div>
                </ng-container>

                <!-- Campo de Rol (solo lectura siempre) -->
                <div class="input-group" *ngIf="!isEditing">
                    <label>Rol</label>
                    <input 
                        type="text" 
                        [value]="getRoleText()" 
                        readonly 
                        class="profile-input readonly-field"
                    >
                </div>

                <!-- Acciones del perfil -->
                <div class="profile-actions">
                    <ng-container *ngIf="!isEditing">
                        <button (click)="toggleEdit()" class="btn-modify">Modificar Datos</button>
                        <button (click)="showDeleteModal = true" class="btn-delete-trigger">Eliminar Cuenta</button>
                    </ng-container>

                    <ng-container *ngIf="isEditing">
                        <button (click)="onUpdate()" class="btn-save">Confirmar Cambios</button>
                        <button (click)="toggleEdit()" class="btn-cancel">Cancelar</button>
                    </ng-container>
                </div>
                
            </div>

            <!-- Columna Derecha: Gesti칩n de Imagen de Perfil -->
            <div class="profile-avatar-section">
                <div class="avatar-display" [ngClass]="{'editing-avatar': isEditing}">
                    <!-- Imagen din치mica (Preview o DB) -->
                    <img 
                        [src]="getProfileImageUrl()" 
                        alt="Avatar de usuario" 
                        class="profile-img-preview"
                    >
                    
                    <!-- Overlay de carga de archivo (Solo en edici칩n) -->
                    <div class="avatar-overlay" *ngIf="isEditing">
                        <label for="file-upload" class="file-label">
                            <span class="icon">游닝</span>
                            <span>Cambiar Foto</span>
                        </label>
                        <input 
                            id="file-upload" 
                            type="file" 
                            (change)="onFileSelected($event)" 
                            accept="image/*"
                            class="file-input-hidden"
                        >
                    </div>
                </div>
                <div class="file-info" *ngIf="isEditing && selectedFile">
                    <p class="file-name">Archivo: {{ selectedFile.name }}</p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Mensaje si no hay usuario logueado-->
    <div *ngIf="!isLoading && !currentUser" class="error-message">
        No se pudo cargar la informaci칩n del perfil. Por favor, inicie sesi칩n.
    </div>

    <!-- Modal de confirmaci칩n para eliminar cuenta -->
    <div class="modal-overlay" *ngIf="showDeleteModal">
        <div class="modal-content">
            <h3 class="modal-title">쮼st치s seguro de borrar tu cuenta?</h3>
            <p class="modal-text">Esta acci칩n es permanente y no se puede deshacer.</p>
            <div class="modal-actions">
                <button (click)="onConfirmDelete()" class="btn-confirm-delete">S칤, eliminar</button>
                <button (click)="showDeleteModal = false" class="btn-cancel-delete">No, mantener cuenta</button>
            </div>
        </div>
    </div>
</div>